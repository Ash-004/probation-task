{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport Cookies from 'universal-cookie';\nimport { useRouter } from 'next/router';\nimport moment from 'moment';\nimport PropTypes from 'prop-types';\nimport Sidebar from '../components/sidebar';\nimport dataFetch from '../utils/dataFetch';\nimport Header from './header';\nimport LoadingScreen from './loadingScreen';\nimport AuthRequired from './authRequired';\nconst cookies = new Cookies();\nconst Base = ({\n  children,\n  title,\n  adminRequired = false,\n  verificationRequired = true\n}) => {\n  const router = useRouter();\n  const {\n    0: loaded,\n    1: setLoaded\n  } = useState(false);\n  const {\n    0: userLoaded,\n    1: setUserLoaded\n  } = useState(false);\n  const {\n    0: data,\n    1: setData\n  } = useState({});\n  const refreshTokenQuery = `\n  mutation refresh($refresh: String!) {\n  refreshToken(refreshToken: $refresh) {\n    token\n    refreshToken\n    payload\n    refreshExpiresIn\n  }\n}\n  `;\n  const refreshTokens = async refreshTokenVariables => dataFetch({\n    query: refreshTokenQuery,\n    variables: refreshTokenVariables\n  });\n  const fetchData = async () => await dataFetch({\n    query: `{ isAdmin isClubMember }`\n  });\n  useEffect(() => {\n    const token = cookies.get('token');\n    const refreshToken = cookies.get('refreshToken');\n    const expiry = cookies.get('expiry');\n    const fetchStatus = () => {\n      if (!userLoaded) {\n        fetchData().then(r => {\n          setData(r.data);\n        }).finally(() => setUserLoaded(true));\n      }\n    };\n    if (!loaded) {\n      if (token !== undefined || refreshToken !== undefined) {\n        fetchStatus();\n        if (moment().unix() + 50 > expiry) {\n          const refreshTokenVariables = {\n            refresh: refreshToken\n          };\n          refreshTokens(refreshTokenVariables).then(response => {\n            if (!Object.prototype.hasOwnProperty.call(response, 'errors')) {\n              const tokenMaxAge = response.data.refreshToken.payload.exp - response.data.refreshToken.payload.origIat;\n              cookies.set('token', response.data.refreshToken.token, {\n                path: '/',\n                maxAge: tokenMaxAge\n              });\n              cookies.set('refreshToken', response.data.refreshToken.refreshToken, {\n                path: '/',\n                maxAge: response.data.refreshToken.refreshExpiresIn\n              });\n              cookies.set('username', response.data.refreshToken.payload.username, {\n                path: '/',\n                maxAge: response.data.refreshToken.refreshExpiresIn\n              });\n              cookies.set('expiry', response.data.refreshToken.payload.exp, {\n                path: '/',\n                maxAge: response.data.refreshToken.refreshExpiresIn\n              });\n            } else {\n              router.push('/logout');\n            }\n          });\n        }\n      } else {\n        router.push('/login');\n      }\n      setLoaded(true);\n    }\n  }, []);\n  return loaded ? adminRequired || verificationRequired ? __jsx(AuthRequired, {\n    loaded: userLoaded,\n    isAdmin: data === null || data === void 0 ? void 0 : data.isAdmin,\n    isClubMember: data === null || data === void 0 ? void 0 : data.isClubMember,\n    verificationRequired: verificationRequired,\n    adminRequired: adminRequired\n  }, __jsx(Header, {\n    title: title\n  }), __jsx(Sidebar, {\n    isAdmin: data === null || data === void 0 ? void 0 : data.isAdmin,\n    selected: router.pathname\n  }, __jsx(\"div\", {\n    style: {\n      minHeight: '100vh'\n    }\n  }, children))) : __jsx(React.Fragment, null, __jsx(Header, {\n    title: title\n  }), __jsx(Sidebar, {\n    isAdmin: data === null || data === void 0 ? void 0 : data.isAdmin,\n    selected: router.pathname\n  }, __jsx(\"div\", {\n    style: {\n      minHeight: '100vh'\n    }\n  }, children))) : __jsx(LoadingScreen, {\n    text: \"Loading...\"\n  });\n};\nBase.propTypes = {\n  title: PropTypes.string,\n  children: PropTypes.node,\n  adminRequired: PropTypes.bool,\n  verificationRequired: PropTypes.bool\n};\nexport default Base;","map":{"version":3,"names":["React","useEffect","useState","Cookies","useRouter","moment","PropTypes","Sidebar","dataFetch","Header","LoadingScreen","AuthRequired","cookies","Base","children","title","adminRequired","verificationRequired","router","loaded","setLoaded","userLoaded","setUserLoaded","data","setData","refreshTokenQuery","refreshTokens","refreshTokenVariables","query","variables","fetchData","token","get","refreshToken","expiry","fetchStatus","then","r","finally","undefined","unix","refresh","response","Object","prototype","hasOwnProperty","call","tokenMaxAge","payload","exp","origIat","set","path","maxAge","refreshExpiresIn","username","push","__jsx","isAdmin","isClubMember","selected","pathname","style","minHeight","Fragment","text","propTypes","string","node","bool"],"sources":["/home/ash/react projects/amFOSS-webapp/components/base.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport Cookies from 'universal-cookie';\nimport { useRouter } from 'next/router';\nimport moment from 'moment';\nimport PropTypes from 'prop-types';\n\nimport Sidebar from '../components/sidebar';\nimport dataFetch from '../utils/dataFetch';\nimport Header from './header';\nimport LoadingScreen from './loadingScreen';\nimport AuthRequired from './authRequired';\n\nconst cookies = new Cookies();\n\nconst Base = ({\n  children,\n  title,\n  adminRequired = false,\n  verificationRequired = true,\n}) => {\n  const router = useRouter();\n  const [loaded, setLoaded] = useState(false);\n  const [userLoaded, setUserLoaded] = useState(false);\n  const [data, setData] = useState({});\n\n  const refreshTokenQuery = `\n  mutation refresh($refresh: String!) {\n  refreshToken(refreshToken: $refresh) {\n    token\n    refreshToken\n    payload\n    refreshExpiresIn\n  }\n}\n  `;\n  const refreshTokens = async (refreshTokenVariables) =>\n    dataFetch({ query: refreshTokenQuery, variables: refreshTokenVariables });\n  const fetchData = async () =>\n    await dataFetch({ query: `{ isAdmin isClubMember }` });\n\n  useEffect(() => {\n    const token = cookies.get('token');\n    const refreshToken = cookies.get('refreshToken');\n    const expiry = cookies.get('expiry');\n    const fetchStatus = () => {\n      if (!userLoaded) {\n        fetchData().then((r) => {\n          setData(r.data);\n        }).finally(() => setUserLoaded(true));\n      }\n    };\n    if (!loaded) {\n      if (token !== undefined || refreshToken !== undefined) {\n        fetchStatus();\n        if (moment().unix() + 50 > expiry) {\n          const refreshTokenVariables = { refresh: refreshToken };\n          refreshTokens(refreshTokenVariables).then((response) => {\n            if (!Object.prototype.hasOwnProperty.call(response, 'errors')) {\n              const tokenMaxAge =\n                response.data.refreshToken.payload.exp -\n                response.data.refreshToken.payload.origIat;\n              cookies.set('token', response.data.refreshToken.token, {\n                path: '/',\n                maxAge: tokenMaxAge,\n              });\n              cookies.set('refreshToken', response.data.refreshToken.refreshToken, {\n                path: '/',\n                maxAge: response.data.refreshToken.refreshExpiresIn,\n              });\n              cookies.set('username', response.data.refreshToken.payload.username, {\n                path: '/',\n                maxAge: response.data.refreshToken.refreshExpiresIn,\n              });\n              cookies.set('expiry', response.data.refreshToken.payload.exp, {\n                path: '/',\n                maxAge: response.data.refreshToken.refreshExpiresIn,\n              });\n            } else {\n              router.push('/logout');\n            }\n          });\n        }\n      } else {\n        router.push('/login');\n      }\n      setLoaded(true);\n    }\n  }, []);\n\n  return loaded ? (\n    adminRequired || verificationRequired ? (\n      <AuthRequired\n        loaded={userLoaded}\n        isAdmin={data?.isAdmin}\n        isClubMember={data?.isClubMember}\n        verificationRequired={verificationRequired}\n        adminRequired={adminRequired}\n      >\n        <Header title={title} />\n        <Sidebar isAdmin={data?.isAdmin} selected={router.pathname}>\n          <div style={{ minHeight: '100vh' }}>{children}</div>\n        </Sidebar>\n      </AuthRequired>\n    ) : (\n      <React.Fragment>\n        <Header title={title} />\n        <Sidebar isAdmin={data?.isAdmin} selected={router.pathname}>\n          <div style={{ minHeight: '100vh' }}>{children}</div>\n        </Sidebar>\n      </React.Fragment>\n    )\n  ) : (\n    <LoadingScreen text=\"Loading...\" />\n  );\n};\n\nBase.propTypes = {\n  title: PropTypes.string,\n  children: PropTypes.node,\n  adminRequired: PropTypes.bool,\n  verificationRequired: PropTypes.bool,\n};\n\nexport default Base;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}